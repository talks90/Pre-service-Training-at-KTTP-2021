#CCNA

# 功能
ARP 是 L2 的協定，透過廣播及單點傳送的方式（稱為 ARP 請求和 ARP 回覆）來達成下列 2 項功能

透過 `arp -a` 可以看到我們的 arp 表![](../img/Pasted%20image%2020201026162942.png)
在 Cisco 的 Router 是 `show ip arp`
##  把 IPv4 位址解析為 MAC 位址
 封包送到網路上的節點時，節點會參照其記憶體裡的表來找看看有沒有目的 IP 位址的 MAC 位址

這個表就稱為 ARP 表或 ARP 快取，存在裝置的 RAM ；它是一行一行的表，裡面只有 IP 位址跟其所繫結的 MAC 位址 2 個欄位，這兩個值之間的關係叫做**對映**
ARP 表會臨時儲存（快取）本地 LAN 上裝置的對映

如果在表裡面有找到對映，節點就會把找到的 MAC 位址作為訊框中的目的 MAC 來封裝 IPv4 封包， 然後再把訊框編碼並發到網路媒體中


## 維護對映表
裝置收集 MAC 位址有兩種方法

- 一種是監控本地網段中發生的通訊
當節點從媒體**收到**訊框的時候，就會把來源 IP 和 MAC 位址記錄為 ARP 表中的對映
- 另一種方法是發送 ARP 請求
1. 它先發廣播給所有電腦，詢問該 IP 是誰？![](../img/Pasted%20image%2020201026133601.png)
2. 等該電腦回覆以後，就有其 MAC 位址了![](../img/Pasted%20image%2020201026133656.png)
3. 這時候就可以發封包給目的電腦囉~~![](../img/Pasted%20image%2020201026134141.png)

ARP 表裡面的資料還會加上時間截，超過時間截都沒有再收到裝置的封包時，就會把這條對映資料先刪除；具體時間取決於裝置及其作業系統，舉例來說，一開始時間截時間可能設為 2 分鐘，這段時間內如果有在取用，那時間可能就會被延長為 10 分鐘

當然也可以靜態加入對映資料囉！靜態加入對映資料沒有時間截，所以如果不想要這筆資料時，也需要手動刪除喔！

 # ARP 的問題
 ## 成本
 我們知道 ARP 是透過廣播的方式來取得目得電腦的 IP 的，如果有大量的電腦剛開機，並開始用網路，網路可能就會被 ARP 的廣播封包塞滿
 
 ## 安全性
 -  ARP 欺騙：發偽造的 ARP 回覆，把偽造的 MAC 位址關聯加入網路，然後訊框就可能發送到錯誤的目的地。
 -   ARP 毒化

## 預防
手動設定 ARP 關聯；有的網路裝置還可以 MAC 的白名單，只允許白名單裡的裝置存取網路。