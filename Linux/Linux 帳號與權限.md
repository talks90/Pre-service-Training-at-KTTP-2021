#Linux

# 使用者與群組的關係

- 當新增使用者的同時，就會同步新增一個與使用者名稱相同的群組，並將新增的使用者直接隸屬於該群組
![](img/Pasted%20image%2020201103102920.png)

# 指令表

\ | 使用者 | 群組
 :---: | :---: | :---:
新增 | useradd | groupadd
刪除 | userdel | groupdel
查詢 | id, w, who, whoami | id, w, who, whoami
修改 | usermod, passwd, chage | groupmod, gpwsswd

# 使用者
## 建立新的使用者
![](img/Pasted%20image%2020201106110623.png)

### 新建使用者時，系統在背地裡幹了什麼？

一般來說，新建帳號時，系統會搞定底下的事情：

- 「拿既有的最大的 UID + 1 作為新的 UID」提供給新用戶
- 在 /home 建立與帳號同名的目錄作為使用者家目錄
- 給予 bash 這個 shell
- 然後 CentOS 也會建立一個與帳號同名的群組給該帳號
- 建立密碼時，會依據預設值給予該帳號一些限制資料

至於新建使用者時，上述的動作參考資料其實是參考 **/etc/default/useradd** 檔案的 ![](img/Pasted%20image%2020201108224829.png)

密碼欄位的預設值則是寫在 /etc/login.defs 這個檔案 ![](img/Pasted%20image%2020201108230258.png)

> 一般來說，除非有特殊的需求，例如需要建立的是雲端集中帳號管理，所以需要修改上述的設定檔資料 (/etc/default/useradd, /etc/login.defs)，否則盡量使用自訂的手動修改使用者相關參數，不要隨意更動上述的檔案內容

## 刪除使用者
加上 `-r` 的參數，連同群組一同刪除![](img/Pasted%20image%2020201106204503.png) 用` cat /etc/passwd | grep peter `已經撈不到資料囉
> 加上 -r 的目的是要該帳號連同家目錄與電子郵件信件夾通通刪除的意思
> 如果忘記加上 -r 的話，那就需要手動刪除用戶的家目錄 /home 與郵件檔案 /var/spool/mail
> 否則同一個帳號就不能再用了![](img/Pasted%20image%2020201108161823.png)

如果真的忘記加上 -r 的選項時的做法 ![](img/Pasted%20image%2020201108231152.png)

## 查詢使用者資料

### 使用者檔案
![](img/Pasted%20image%2020201106113836.png)

#### /etc/passwd 欄位說明

| 欄位 | 說明                                  |
|:----:|:------------------------------------- |
|  1   | 登入的帳號名稱                        |
|  2   | 密碼映射到 /etc/shadow，這裡用 x 代替 |
|  3   | UID                                   |
|  4   | GID，使用者的「初始群組」 ID          |
|  5   | 使用者註記                            |
|  6   | 家目錄所在處                          |
|  7   | 預設登入時取得的 shell 名稱           |

#### 第 3 欄 - UID 的範圍

| id 範圍 | 該 id 使用者特性 |
|:-------:|:---------------- |
0  | 系統管理員
1-999 | 系統帳號；1-200 系統發行商建的系統帳號、201-999 使用者可用的 uid
1000-6000 | 給一般使用者用；其實 Linux 核心可以支援到 32 位元的 UID 記載， 也就是可以支援到 4294967295 (2^32-1) 這麼多的 UID

### 使用者密碼
![](img/Pasted%20image%2020201106113641.png)

#### /etc/shadow 欄位說明

欄位 | 說明
:---: | :---
1 | loginname
2 | 密碼，預設用 sha512 驗證；!! 的意思是密碼還沒設定，帳號無法登入
3 | 帳號建立日期，從 1970/1/1 起算的太陽日
4 | min，密碼最快可以變更的日期
5 | max，密碼最大有效日期， 99999 天大概快 274 年
6 | warning，警告
7 | 寬限（一般是空白）
8 | 帳號到期日；不管密碼是否正確都不能再用
9 | 保留

> 可以用 `man 5 gshadow` 看詳細文件

## 修改使用者的登入名稱
![](img/Pasted%20image%2020201106212308.png)

- 跟著改的檔案
	- /etc/passwd![](img/Pasted%20image%2020201106124144.png)
	- /etc/shadow![](img/Pasted%20image%2020201106124315.png)
	- /etc/gshadow，注意群組名稱還是原來的 peter ![](img/Pasted%20image%2020201106124503.png)
- 沒有跟著改的檔案
	- /etc/group![](img/Pasted%20image%2020201106124408.png)

## 修改使用者密碼
![](img/Pasted%20image%2020201106111333.png)
> 雖然密碼不符合規定，但因為是用 root 身分設定，所以系統只抵抗 2 次意思一下後，就硬上了

### 修改使用者密碼的設定

#### 密碼最多可以用多久
![](img/Pasted%20image%2020201106131314.png)

#### 密碼最快多久可以改
![](img/Pasted%20image%2020201106131425.png)

#### 密碼的有效期限
![](img/Pasted%20image%2020201106131606.png)

#### 列出來看一下
![](img/Pasted%20image%2020201106131757.png)

# 群組

## 建立新的群組
![](img/Pasted%20image%2020201106114208.png)

## 刪除群組
![](img/Pasted%20image%2020201106115356.png)
當群組被當成主要群組（家）的時候不能刪![](img/Pasted%20image%2020201106131939.png)

## 查詢群組資料
第 1 招，從 /etc/group 查 ![](img/Pasted%20image%2020201107200030.png)
第 2 招，從 /etc/gshadow 查 ![](img/Pasted%20image%2020201106111849.png)

## 修改群組密碼
![](img/Pasted%20image%2020201106111535.png)
> 實務上比較少去做設定

## 設定群組管理者
![](img/Pasted%20image%2020201106213141.png)設定成功

## 拉人進群組
第 1 招![](img/Pasted%20image%2020201106112956.png)
第 2 招，老師建議用這個方法較佳![](img/Pasted%20image%2020201106141354.png)
成功拉進來了！![](img/Pasted%20image%2020201106113452.png)![](img/Pasted%20image%2020201106114103.png)

## 把人踢出群組
![](img/Pasted%20image%2020201106115302.png)

## 切換主要群組
使用者 ![](img/Pasted%20image%2020201108232547.png)
管理者 ![](img/Pasted%20image%2020201106141127.png)  
新增檔案時，擁有群組會依擁有者主群組的設定來設![](img/Pasted%20image%2020201107220818.png)

# 查詢指令
## 在線使用者有誰
簡易版 - `who` ![](img/Pasted%20image%2020201106132759.png)
詳細版 - `w` ![](img/Pasted%20image%2020201106132631.png)

### 白爛的指令 - 我是誰？
`whoami` 
![](img/Pasted%20image%2020201106135606.png)
