#Linux 

# 權限設定對象

針對 Linux 的系統資源做設定
- 檔案
- 目錄

# 檔案權限怎麼看

第 1 招 ![](img/Pasted%20image%2020201106215223.png)

| 類型 | 意思                                                                                          |
|:----:|:--------------------------------------------------------------------------------------------- |
|  A   | 檔案類型與權限，第 1 個字元為檔案類型，後續 9 個字元每 3 個一組，共分 3 組，為 3 種身份的權限 |
|  B   | 檔案連結數，這與檔案系統有關                                                                  |
|  C   | 檔案的擁有者                                                                                  |
|  D   | 檔案的所屬群組                                                                                |
|  E   | 檔案容量                                                                                      |
|  F   | 檔案最後一次被修改/修訂的日期時間                                                             |
|  G   | 檔名，如果檔名前多一個「 . 」，代表是「隱藏檔」 |

## 第 1 個位元代表什麼檔案類型呢？！

類型 | 意思
:---: | :---
\- | 一般檔案
d | 目錄
l | 連結檔 (有點類似 windows 的捷徑概念)
b | 裝置檔，該裝置主要為區塊裝置，大多為硬碟或隨身碟
c | 週邊裝置檔，例如滑鼠、鍵盤等

第 2 招 ![](img/Pasted%20image%2020201106230326.png)

## 有 3 種身份要設定

1. user / owner - 檔案的擁有者
2. group - 檔案的擁有群組
3. other - 不屬於以上二者以外的人

## 權限的類型

| 類型 |  在一般檔案的意義 | 在目錄的意義                                       |
| ---- |  ---------------- | -------------------------------------------------- |
| r    | 可讀取檔案內容   | 可以讀取目錄結構清單，也就是說可以讀到目錄下的檔名 |
| w    |  可修改檔案內容   | 可以修改目錄結構清單，也就是說可以對目錄下的檔案及目錄做新增、移動、刪除（不論權限） |
| x    | 檔案可以被執行   | 進入目錄的權限(key)；如果單有 r 沒有 x 也無法讀取喔！ |

# 如何更改身分

## 變更擁有者
使用` chown `修改檔案擁有者![](img/Pasted%20image%2020201107205457.png)
> 這個指令只有 root 可以使用；即使你是檔案的擁有人，也無法把檔案的擁有權給別人![](img/Pasted%20image%2020201107210837.png)

## 變更擁有群組
使用` chgrp `修改檔案擁有的群組![](img/Pasted%20image%2020201107211023.png)
` chown `也可以拿來改擁有群組![](img/Pasted%20image%2020201107212222.png)
![](img/Pasted%20image%2020201108234354.png)

# 如何更改權限

## 符號法
使用` chmod `指令，配合 u,g,o,a 代表使用者、群組、其他人與所有人， 然後使用 +, -, = 來加入/減少/直接設定權限![](img/Pasted%20image%2020201107213359.png)

## 數字法
為了方便可以使用 2 進位的方式取代符號做設定，各權限代表數字如下：
- r ==> read    ==> $2^2$ ==> 4
- w ==> write   ==> $2^1$ ==> 2
- x ==> eXecute ==> $2^0$ ==> 1

所以權限最低 0 分，最高是 r+w+x --> 4+2+1 --> 7 分！因為有 3 種身份，所以數字組合最多為 777 最少為 000
> 如果設定時數字組不足 3 個，會從左邊開始補 0，如只有打 1，則會變為 001 的組合

![](img/Pasted%20image%2020201107215646.png)

# 特殊權限 SUID/SGID/SBIT 的功能

主要是針對「運作當下所需要的權限」來設計的，與操作時所需的特權權限 (root 身份或額外群組) 有關

## SUID

舉例來說，系統的密碼紀錄在 /etc/shadow 內，使用者並沒有權限可以更改，但遇到使用者要改密碼的時候怎麼辦？Linux 用一種叫做 Set UID (SUID) 的技術來處理這麼情況

系統設定一個 SUID 的權限旗標到 passwd 執行擋上， 當使用者執行 passwd 指令時，就能夠藉由 SUID 來切換執行權限

SUID 的基本功能為：
- SUID 權限僅對二進位程式(binary program)有效
- 執行者對於該程式需要具有 x 的可執行權限
- 本權限僅在執行該程式的過程中有效 (run-time)
- 執行者將具有該程式擁有者 (owner) 的權限

觀察 /usr/bin/passwd 的權限資料![](img/Pasted%20image%2020201108195223.png)

- 使用者權限的 x 變成了 s ，此即 SUID 的權限旗標
- 由 SUID 的定義來看，passwd 設定了 SUID，且 passwd 的擁有者為 root 這個人， 因此只要任何具有 x 權限的用戶在執行 passwd 時，就會自動透過 SUID 轉換身份為 root

```
--bash(student)--+..................+---bash(student)--->
                 |                  |
                 |--passwd(root)----|
```

## SGID

SGID 是群組的特殊權限

- SGID 設在檔案上的功能為：
	- SGID 對二進位程式有用
	- 程式執行者對於該程式來說，需具備 x 的權限
	- 執行者在執行的過程中將會獲得該程式群組的支援！

- SGID 設在目錄上的功能為：
	- 使用者若對於此目錄具有 r 與 x 的權限時，該使用者能夠進入此目錄
	- 使用者在此目錄下的有效群組(effective group)將會變成該目錄的群組
	- 用途：如果使用者有目錄的 w 權限(可以新建檔案)，則使用者在這個目錄下所建立的新檔案，擁有群組會跟目錄的擁有群組一樣

## SBIT

舉例來說，/tmp 是所有帳號都可以寫入的一個暫存目錄，因此 /tmp 理論上應該是 777 的權限才行；但如果是 777 的權限， 代表任何人所建立的任何資料，都可能被隨意的刪除，這就有問題

SBIT的功能為：
- 當使用者對於此目錄具有 w, x 權限，亦即具有寫入的權限時
- 當使用者在該目錄下建立檔案或目錄時，僅有自己與 root 才有權力刪除該檔案
- **各人造業各人擔；不管權限怎麼設，只有檔案擁有者才可以刪檔案**

## SUID/SGID/SBIT 權限的設定

SUID/SGID/SBIT 的權限旗標是在 Linux 的傳統 3 個身份 3 個權限之外的第 4 個權限

### 符號法

- SUID: chmod u+s filename
- SGID: chmod g+s filename
- SBIT: chmod o+t filename


### 數字法

權限分數加在原有的 3 位數組的左邊（數字加在最前面），變成 4 位數組

計算方式為：
- SUID 為 4
- SGID 為 2
- SBIT 為 1
